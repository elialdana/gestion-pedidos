--   -------------------------------------------------- 
--   Generated by Enterprise Architect Version 10.0.1008
--   Created On : Sunday, 25 July, 2021 
--   DBMS       : MySql 
--   -------------------------------------------------- 



--  Drop Tables, Stored Procedures and Views 

DROP TABLE IF EXISTS MATERIALES_UTILIZADOS CASCADE
;
DROP TABLE IF EXISTS PAGOS_PEDIDO CASCADE
;
DROP TABLE IF EXISTS PRODUCTOS CASCADE
;
DROP TABLE IF EXISTS DETALLE_PEDIDO_CLIENTE CASCADE
;
DROP TABLE IF EXISTS USUARIOS CASCADE
;
DROP TABLE IF EXISTS MATERIALES_FABRICACION CASCADE
;
DROP TABLE IF EXISTS PEDIDO_CLIENTE CASCADE
;
DROP TABLE IF EXISTS CLIENTES CASCADE
;
DROP TABLE IF EXISTS PROVEEDORES CASCADE
;

--  Create Tables 
CREATE TABLE MATERIALES_UTILIZADOS
(
	DETALLE_PEDIDO_ID BIGINT,
	MATERIAL_ID BIGINT,
	CANTIDAD DECIMAL(10,2),
	UNIDAD_MEDIDA BIGINT

) 
;


CREATE TABLE PAGOS_PEDIDO
(
	ID BIGINT,
	PEDIDO_ID BIGINT,
	ABONO DECIMAL(15,4),
	FECHA_ABONO DATE,
	DESCRIPCION VARCHAR(50)

) 
;


CREATE TABLE PRODUCTOS
(
	ID BIGINT NOT NULL COMMENT 'IDENTIFICADOR UNICO',
	CODIGO VARCHAR(20) NOT NULL COMMENT 'CODIGO DEL PRODUCTO',
	NOMBRE VARCHAR(80) NOT NULL COMMENT 'NOMBRE DEL PRODUCTO QUE VENDE LA EMPRESA',
	DESCRIPCION VARCHAR(150) COMMENT 'EN ESTE CAMPO PUEDE IR UNA DESCRIPCION DE LAS CARACTERISTICAS QUE TIENE EL PRODUCTO',
	ESTADO CHAR(2) COMMENT 'ESTADO DEL PRODUCTO ACTIVO/INACTIVO',
	PRIMARY KEY (ID),
	UNIQUE UQ_PRODUCTOS_CODIGO(CODIGO),
	UNIQUE UQ_PRODUCTOS_ID(ID),
	UNIQUE UQ_PRODUCTOS_NOMBRE(NOMBRE)

)  COMMENT='PRODUCTOS QUE MANEJA LA EMPRESA'
;


CREATE TABLE DETALLE_PEDIDO_CLIENTE
(
	ID BIGINT NOT NULL COMMENT 'IDENFITICADOR UNICO',
	PEDIDO_ID BIGINT NOT NULL COMMENT 'ENCABEZADO DEL PEDIDO',
	PRODUCTO_ID BIGINT NOT NULL COMMENT 'PRODUCTO SOLICITADO',
	COMENTARIO VARCHAR(100) COMMENT 'COMENTARIO DE COSAS EXTRAS QUE SOLICITE EL CLIENTE',
	COSTO_ADICIONAL DECIMAL(15,4) DEFAULT 0 COMMENT 'SI INCLUYE ALGUN COSTO ADICIONAL EL PRODUCTO QUE NO FUE ESPERADO',
	COSTO_INSTALACION DECIMAL(15,4) DEFAULT 0 COMMENT 'COSTO DE INSTALACION',
	DESCUENTO DECIMAL(10,4) DEFAULT 0 COMMENT 'DESCUENTO QUE SE INCLUYA AL PRODUCTO',
	CANTIDAD DECIMAL(10),
	MONTO DECIMAL(15,4) DEFAULT 0 COMMENT 'PRECIO FINAL DEL PRODUCTO',
	PRIMARY KEY (ID),
	UNIQUE UQ_PRODUCTO_FABRICADO_ID(ID),
	KEY (PEDIDO_ID),
	KEY (PRODUCTO_ID)

)  COMMENT='TABLA PARA GUARDAR EL PRODUCTO SOLICITADO'
;


CREATE TABLE USUARIOS
(
	USUARIO VARCHAR(15) NOT NULL COMMENT 'NOMBRE DE USUARIO ',
	DPI VARCHAR(13),
	PASSWORD TEXT COMMENT 'CONTRASEÑA',
	NOMBRE VARCHAR(80) COMMENT 'NOMBRE DE USUARIO',
	DIRECCION VARCHAR(100),
	TELEFONO VARCHAR(13),
	PERFIL TEXT COMMENT 'perfil del usuario',
	FOTO TEXT COMMENT 'FOTO DEL  USUARIO',
	ESTADO CHAR(1) NOT NULL DEFAULT A COMMENT 'estado del usuario   ACTIVO / INACTIVO',
	ULTIMO_LOGIN DATETIME COMMENT 'ULTIMO INGRESO DEL USUARIO',
	FECHA_REGISTRO DATETIME COMMENT 'FECHA DE REGISTRO DEL USUARIO',
	PRIMARY KEY (USUARIO)

)  COMMENT='tabla de usuarios del sistema'
;


CREATE TABLE MATERIALES_FABRICACION
(
	ID BIGINT NOT NULL COMMENT 'IDENTIFICADOR UNICO',
	CODIGO VARCHAR(20),
	NOMBRE VARCHAR(80),
	DESCRIPCION VARCHAR(50),
	PROVEEDOR_ID BIGINT,
	PRECIO_VENTA DECIMAL(15,4) COMMENT 'TOTAL POR MATERIAL UTILIZADO',
	PRECIO_COMPRA DECIMAL(15,4),
	STOCK DECIMAL(15,4),
	TELEFONO_NOTIFICACION VARCHAR(13),
	EMAIL_NOTIFICACION VARCHAR(100),
	PRIMARY KEY (ID),
	UNIQUE UQ_MATERIALES_FABRICACION_ID(ID),
	KEY (PROVEEDOR_ID)

)  COMMENT='MATERIALES DE LA FABRICACION'
;


CREATE TABLE PEDIDO_CLIENTE
(
	ID BIGINT NOT NULL COMMENT 'IDENTIFICADOR UNICO',
	CLIENTE_ID BIGINT,
	COMENTARIO VARCHAR(200) COMMENT 'COMENTARIO EXTRA SOBRE EL PEDIDO, POR EJEMPLO SI EL CLIENTE QUIERE UN DETALLE EN ESPECIAL ',
	ESTADO CHAR(3) COMMENT 'ESTADO PARA SABER EN QUE FASE SE ENCUENTRA EL PEDIDO',
	TOTAL DECIMAL(15,4) NOT NULL DEFAULT 0 COMMENT 'TOTAL A PAGAR',
	FECHA_INGRESO DATETIME COMMENT 'FECHA QUE SE INGRESO EL PEDIDO',
	FECHA_ENTREGA DATETIME COMMENT 'FECHA DE ENTREGA DEL PEDIDO',
	FECHA_MODIFICACION DATETIME COMMENT 'fecha de modificacion del registro',
	USURIO_REGISTRO VARCHAR(20) COMMENT 'usuario que modifico el registro',
	USUARIO_MODIFICA VARCHAR(20) COMMENT 'usuario que realizo la ultima modificacion',
	DIRECCION VARCHAR(100) COMMENT 'DIRECCION EN DONDE SE INSTALARA EL PEDIDO',
	PRIMARY KEY (ID),
	UNIQUE UQ_PEDIDO_ID(ID),
	KEY (CLIENTE_ID)

) 
;


CREATE TABLE CLIENTES
(
	ID BIGINT NOT NULL COMMENT 'IDENTIFICADOR UNICO',
	DPI VARCHAR(13),
	NIT VARCHAR(13) COMMENT 'NIT DEL CLIENTE SI REQUIERE FACTURA',
	NOMBRE VARCHAR(80) NOT NULL COMMENT 'NOMBRE DEL CLIENTE',
	DOMICILIO VARCHAR(120) COMMENT 'DIRECCION PARA ENVIO DEL PEDIDO',
	TELEFONO_UNO VARCHAR(15) NOT NULL COMMENT 'TELEFONO DE CONTACTO',
	TELEFONO_DOS VARCHAR(15) COMMENT 'TELEFONO ADICIONAL AL QUE PUEDAN LLAMAR',
	CORREO_ELECTRONICO VARCHAR(100) COMMENT 'CORREO ELECTRONICO PARA NOTIFICACIONES',
	PRIMARY KEY (ID),
	UNIQUE UQ_CLIENTES_ID(ID),
	UNIQUE UQ_CLIENTES_NOMBRE(NOMBRE)

)  COMMENT='TABLA PARA GUARDAR EL NUEVO CLIENTE'
;


CREATE TABLE PROVEEDORES
(
	ID BIGINT NOT NULL COMMENT 'IDENTIFICADOR UNICO',
	CODIGO VARCHAR(20) NOT NULL COMMENT 'CODIGO DE LA EMPRESA',
	NOMBRE VARCHAR(80) NOT NULL COMMENT 'NOMBRE DE LA EMPRESA',
	TELEFONO VARCHAR(15),
	CORREO_ELECTRONICO VARCHAR(150),
	DIRECCION NVARCHAR(150) COMMENT 'DIRECCION DEL PROVEEDOR',
	DESCRIPCION VARCHAR(100) COMMENT 'DESCRIPCION PARA EXPLICAR QUE PROVEE ESA EMPRESA',
	PRIMARY KEY (ID),
	UNIQUE UQ_PROVEEDORES_CODIGO(CODIGO),
	UNIQUE UQ_PROVEEDORES_ID(ID),
	UNIQUE UQ_PROVEEDORES_NOMBRE(NOMBRE)

)  COMMENT='TABLA PARA GUARDAR LOS PROVEEDORES DE MATERIALES DE LA EMPRESA'
;





--  Create Foreign Key Constraints 
ALTER TABLE DETALLE_PEDIDO_CLIENTE ADD CONSTRAINT FK_DETALLE_PEDIDO_PEDIDO 
	FOREIGN KEY (PEDIDO_ID) REFERENCES PEDIDO_CLIENTE (ID)
;

ALTER TABLE DETALLE_PEDIDO_CLIENTE ADD CONSTRAINT FK_DETALLE_PEDIDO_PRODUCTOS 
	FOREIGN KEY (PRODUCTO_ID) REFERENCES PRODUCTOS (ID)
;

ALTER TABLE MATERIALES_FABRICACION ADD CONSTRAINT FK_TLC_MATERIALES_FABRICACION_TLC_PROVEEDORES 
	FOREIGN KEY (PROVEEDOR_ID) REFERENCES PROVEEDORES (ID)
;

ALTER TABLE PEDIDO_CLIENTE ADD CONSTRAINT FK_PEDIDO_CLIENTES 
	FOREIGN KEY (CLIENTE_ID) REFERENCES CLIENTES (ID)
;
